{% extends "base.html" %}

{% block content %}
<div class="container text-center position-relative">
    <a href="{% url 'tools:home' %}" class="btn btn-outline-primary back-btn">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    
    <h1 class="mb-4">Base64 –ö–æ–¥–∏—Ä–æ–≤—â–∏–∫ / –î–µ–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫</h1>

    <form method="post" class="text-start">
        {% csrf_token %}
        <div class="mb-3">
            <textarea name="text"
                      id="input-text"
                      class="form-control"
                      rows="6"
                      placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ Base64 —Å—Ç—Ä–æ–∫—É">{{ input_text }}</textarea>
        </div>

        <div class="d-grid d-md-block">
            <button type="submit" name="action" value="encode" class="btn btn-primary btn-custom">–ö–æ–¥–∏—Ä–æ–≤–∞—Ç—å</button>
            <button type="submit" name="action" value="decode" class="btn btn-outline-secondary btn-custom">–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div class="result-box mt-4">
        <h5 class="mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h5>
        {% if encoded %}
            <div class="alert alert-success d-flex justify-content-between align-items-center"
                 role="alert"
                 id="encoded-result">
                <pre class="mb-0 flex-grow-1">{{ encoded }}</pre>
                <button class="btn btn-sm btn-outline-light copy-btn"
                        onclick="copyText('encoded-result')">üìã</button>
            </div>
        {% endif %}

        {% if decoded and decoded != "–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è" %}
            <div class="alert alert-info d-flex justify-content-between align-items-center"
                 role="alert"
                 id="decoded-result">
                <pre class="mb-0 flex-grow-1">{{ decoded }}</pre>
                <button class="btn btn-sm btn-outline-light copy-btn"
                        onclick="copyText('decoded-result')">üìã</button>
            </div>
        {% elif decoded == "–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è" %}
            <div class="alert alert-danger" role="alert">
                ‚ùå {{ decoded }}
            </div>
        {% endif %}
    </div>
</div>

<!-- JavaScript –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
<script>
    function copyText(elementId) {
        const el = document.getElementById(elementId);
        const text = el.querySelector("pre").innerText.trim();

        navigator.clipboard.writeText(text).then(function () {
            alert('‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ' + text.substring(0, 30) + (text.length > 30 ? '...' : ''));
        }, function (err) {
            alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
            console.error(err);
        });
    }
</script>

<style>
    .back-btn {
        position: absolute;
        top: 20px;
        left: 20px;
    }
    .btn-custom {
        margin: 5px;
        min-width: 150px;
    }
    .copy-btn {
        margin-left: 10px;
    }
    pre {
        white-space: pre-wrap;
        word-wrap: break-word;
    }
</style>
{% endblock %}